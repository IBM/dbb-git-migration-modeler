# Migration storyboard

The DBB Git Migration Modeler takes the user through 4 major phases:

## The Framing phase 

For this first phase, the utility is offering a **framework to define which applications exist in today's SCM system**, their owners and which artifacts (COBOL, JCL, PROCs) belong to these applications.
The schema to define this information is captured in the [Applications Mapping file](../samples/applications-mapping/applicationsMapping.yaml) (YAML format).
Another configuration file used as input, known as the [Repository Paths Mapping file](../samples/repositoryPathsMapping.yaml) allows users to define how artifacts are mapped to a repository structure.

The produced files (called **Application Descriptor** files) of this first phase contain the list of artifacts that are owned by each application. This version of the Application Descriptor files can be used to communicate with the application owners, to gain their agreement about the content of the applications they own.
It can serve as a control point in the planning and the execution of the migration process.

The outcome of this phase is a formalized documentation of today's knowledge about the existing applications with the perspectives of ownership, technical composition, and build framework configuration.

The other files generated by this phase are DBB Migration Mapping files, which are also used during this phase to copy the files from datasets to z/OS UNIX System Services folders, that could represent Git repositories.
This step uses the DBB Migration utility to perform the copy to USS folders, also ensuring the correctness of the mapping and the absence of non-roundtripable and non-printable characters, that could affect the migration.

## The Assessment phase

The copy that occurred during the previous phase is probably not the final migration of the members, but it facilitates the **analyzis of artifacts' usage**, especially those that nobody claims and that are perceived as shared.
This helps in specific situations where ownership of include files and programs is undefined and unclear, potentially because some or all of these include files and programs used to be accessible by all applications in a previous configuration.
For programs, the usage assessment is performed with statically linked submodules.

After migrating the code, the source code of all applications will be scanned, before the classification process is performed: 
   * During this process, the utility will place the unassigned Include Files into an application's folder structure if this applications was determined as the owner (in the case that a single application was identified as using the artifact).
   The Application Descriptor files are updated accordingly.  
   * For include files and programs that already are claimed by an application, the same classification process is performed to document the usage of these files.
   For Include Files, their scope is changed to *private* if only programs from this application are referencing this given include file, otherwise *public* if multiple applications are refering to this include file.  
   For Programs, their scope is changed to *internal submodule* if only programs from this application are statically linking this given program, otherwise *service submodule* if multiple applications are statically linking this program.
   Again, the application descriptor will be updated accordingly.

This analysis has to occur on the entire codebase of all applications to ensure correct recommendations and results.

The output files of this process are crucial to gain the final approval from the application teams about the scope of applications.
After this stage, the DBB Migration mapping files are also updated accordingly, to reflect the new locations of the moved files.

## The Property Generation phase

This stage is optional and allows to statically migrate build configuration from the legacy system to the new build framework and generate build configurations.
We encourage customers to use the dynamic scanners in Dependency Based Build to determine the runtime flags for each build file.
The outputs of this stage becomes relevant when the final migration is taking place.

The purpose of this stage is to generate properties and property files that are used by the [dbb-zAppBuild](https://github.com/IBM/dbb-zappbuild/) framework, based on the information gathered in a specific input file, the [Types file](../samples/types.txt), defined later in this documentation.

This phase will generate the necessary properties and files required to leverage the [Language configuration  mapping](https://github.com/IBM/dbb-zappbuild/blob/main/docs/FilePropertyManagement.md#language-configuration-mapping) feature available in [dbb-zAppBuild](https://github.com/IBM/dbb-zappbuild/).
Each composite type will be created (if not already existing) and will combine properties to represent a unique Language Configuration.
At the application level, file-level overrides are also generated and inserted in the application's [application-conf](https://github.com/IBM/dbb-zappbuild/tree/main/samples/application-conf) folder.

## The Initialization phase

The purpose of this stage is to prepare the applications' Git repositories. It perform several tasks:
* Initialization of the Git repository
* Staging of the source files and the customized configuration files (the ZAPP.yaml file and the pipeline definition files)
* Execution of a first commit
* Creation of a tag to identify a baseline version
* Execution of a preview build 
* Creation of a package containing the applications' artifacts into a baseline archive, that can be optionally uploaded to an Artifact Repository server

## Refreshing the Application Descriptor files

For applications that are already migrated to Git, the DBB Git Migration Modeler provides a feature to generate Application Descriptor files. More information can be found in the [Refreshing Application Descriptor files](./04-Usage#refreshing-application-descriptor-files) section.

## Outcomes and benefits
* Documentation about which files are owned by which application.
* Classification of include files and statically linked programs.
* Documentation of cross-application dependencies and consuming applications
* Insights about non-roundtripable / non-printable characters.
* Relevant information to plan the migration of all applications.
* Ready-to-use configuration files based on the originating SCM's knowledge base

## Output files

When running this utility, two main types of files will be created for each application that are discovered:
* An Application Descriptor file (YAML format): this file is built during the analysis of the datasets members provided as input. It contains the list of artifacts that belong to this application, with properties that are updated when the usage of Include Files and Programs is performed. 
  * [The Framing phase](#the-framing-phase) stores the files in a shared configuration folder (named *work-configs* by default).
  * [The Assessment phase](#the-assessment-phase) produces an updated Application Descriptor file, which is stored within the application's folder.
  This allows to compare the Application Descriptor files between the Framing phase and the Assessment phase.
* A DBB Migration Mapping file (Text format): this file contains instructions on how the DBB Migration utility should operate when running a migration.
This structure of mapping file and how to invoke the DBB Migration utility with a mapping file is described in [the official DBB documentation](https://www.ibm.com/docs/en/dbb/2.0?topic=migrating-source-files-from-zos-git#running-migration-using-a-mapping-file).

For [the Property Generation phase](#the-property-generation-phase), the following output files are created:
* Language Configuration files, containing properties defined for types configurations (as defined in the [Types Configurations file](../samples/typesConfigurations.yaml)).
These Language Configuration files are stored in a custom *dbb-zAppBuild* instance which is copied from an original *dbb-zAppbuild* folder.
The location of these files is the [build-conf/language-conf](https://github.com/IBM/dbb-zappbuild/tree/main/build-conf/language-conf) folder in the custom *dbb-zAppBuild* instance.
* For each analyzed application, an [application-conf](https://github.com/IBM/dbb-zappbuild/tree/main/samples/application-conf) folder is copied from the original *dbb-zAppBuild* instance, in which two files are customized:
  * A line is added in [file.properties](https://github.com/IBM/dbb-zappbuild/blob/main/samples/application-conf/file.properties) to enable the use of Language Configuration mappings.
  This line is commented by default, and users are asked to uncomment to enable this capability.
  * For each artifact of the application, an entry is added in [languageConfigurationMapping.properties](https://github.com/IBM/dbb-zappbuild/blob/main/samples/application-conf/languageConfigurationMapping.properties), which maps the artifact with its Language Configuration defined in [build-conf/language-conf](https://github.com/IBM/dbb-zappbuild/tree/main/build-conf/language-conf)


# Setting up the DBB Git Migration Modeler utility

To setup the DBB Git Migration Modeler, follow the instructions [on this page](./02-Setup.md). 